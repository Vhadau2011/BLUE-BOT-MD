const path=require('path'),fs=require('fs'),ffmpegPath=require('@ffmpeg-installer/ffmpeg')['path'],ffmpeg=require('fluent-ffmpeg');ffmpeg['setFfmpegPath'](ffmpegPath);const axios=require('axios'),{genererNomFichier}=require('./mesfonctions'),getAudioFromUrl=async o=>{try{const K=await axios['get']('https://social-media-downloader-smoky.vercel.app/ytdl/mp3?url='+o);if(!K?.['data']?.['status'])throw new Error('Audio\x20not\x20found');const a=K['data']['results'];let u=a?.['128kbps']?.['status']==='tunnel'?a['128kbps']['url']:null;if(!u){const c=Object['values'](a)['find'](J=>J?.['status']==='tunnel'&&J?.['url']);if(!c)throw new Error('No\x20downloadable\x20audio\x20found');u=c['url'];}const l=genererNomFichier('mp3'),p=await axios({'method':'GET','url':u,'responseType':'stream'});return new Promise((J,g)=>{ffmpeg(p['data'])['audioCodec']('libmp3lame')['format']('mp3')['save'](l)['on']('end',()=>J(l))['on']('error',M=>g(M));});}catch(J){console['error']('An\x20error\x20occurred\x20while\x20fetching\x20audio\x20from\x20URL:',J);throw J;}};module['exports']['getAudioFromUrl']=getAudioFromUrl;const getVideoFromUrl=async o=>{try{const K=await axios['get']('https://social-media-downloader-smoky.vercel.app/ytdl/mp4?url='+o),a=K['data']['results'];let u=a?.['360p']?.['status']==='tunnel'?a['360p']['url']:null;if(!u){const J=Object['entries'](a)['filter'](([g,M])=>M?.['status']==='tunnel'&&M?.['url'])['sort'](([g],[M])=>{const E=parseInt(g['replace']('p',''),0xa),h=parseInt(M['replace']('p',''),0xa);return h-E;});if(J['length']===0x0)throw new Error('No\x20downloadable\x20video\x20found');u=J[0x0][0x1]['url'];}const l=genererNomFichier('mp4'),p=await axios({'method':'GET','url':u,'responseType':'stream'}),c=p['data']['pipe'](fs['createWriteStream'](l));return new Promise((g,M)=>{c['on']('finish',async()=>{g(l);}),c['on']('error',E=>{M(E);});});}catch(g){throw g;}};module['exports']['getVideoFromUrl']=getVideoFromUrl;const combineAudioVideo=(o,K,a)=>{return new Promise((u,l)=>{ffmpeg()['input'](K)['input'](o)['outputOptions']('-c:v\x20copy')['outputOptions']('-c:a\x20aac')['save'](a)['on']('end',()=>{fs['unlinkSync'](o),fs['unlinkSync'](K),u(a);})['on']('error',p=>{l(p);});});},convertAudioTomp3=async(o,K)=>{return new Promise((a,u)=>{ffmpeg()['input'](o)['toFormat']('mp3')['save'](K)['on']('end',()=>{a(K);})['on']('error',l=>{u(l);});});};module['exports']['convertAudioTomp3']=convertAudioTomp3;require['main']===module&&((async()=>{const o=await getVideoFromUrl('https://youtube.com/watch?v=WQQ4pBn1gHs');console['log']('Audio\x20downloaded\x20successfully:',o);})());